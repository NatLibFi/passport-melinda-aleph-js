---
kind: pipeline
type: docker
name: Default

trigger:
  event:
    - push
    - tag

steps:

  - name: audit
    image: node:14
    commands:
      - npm audit --package-lock-only --production --audit-level=moderate

  - name: install
    image: node:14
    environment:
      NPM_CONFIG_IGNORE_SCRIPTS: true
    commands:
      - npm ci

  - name: test
    image: node:14
    commands:
      - npm test

  - name: check-coverage
    image: node:14
    commands:
      - npm run coverage

  - name: build
    image: node:14
    commands:
      - npm run build
      - npm ci --production

  - name: static-security-scan
    image: quay.io/natlibfi/njsscan
    commands:
      - njsscan dist

  - name: npm
    image: plugins/npm
    settings:
      registry: 'https://registry.npmjs.org/'
      token:
        from_secret: npm_token
    when:
      event: tag
---
kind: pipeline
type: docker
name: Update dependencies

trigger:
  event:
    - custom
  branch:
    - master

steps:

  - name: publish
    image: quay.io/natlibfi/drone-npm-git-publish
    settings:
      git_user_name: natlibfi-melinda-automation
      git_user_email: 65649125+natlibfi-melinda-automation@users.noreply.github.com
      git_ssh_key:
        from_secret: ssh_key
      git_gpg_key:
        from_secret: gpg_key
---
kind: secret
name: npm_token
data: PUKCrxPqpRxd2AC4VVGNyesqRyjM6h2nwGu/TDUaVLxQKzsWGbuFksViW41u+xRoNmolX//A+CGG0xsPTsTU1g==
---
kind: secret
name: ssh_key
data: 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
---
kind: secret
name: gpg_key
data: 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
---
kind: signature
hmac: 946deaee40a73d3772ec1bf7ff6bab048f6b7decd4936b206b25f5e0884a5d3d

...
